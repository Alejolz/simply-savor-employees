<div class="min-h-screen bg-gray-50">
  <!-- NAVBAR -->
  <nav class="backdrop-blur-md bg-white/80 border-b border-gray-200 sticky top-0 z-50 shadow-md px-6 mb-6">
    <div class="container mx-auto flex justify-between items-center h-16">
      <!-- Logo -->
      <a class="flex items-center font-bold text-xl" href="#">
        <div class="bg-gradient-to-r from-[#11a92f] to-[#067f2d] p-2 rounded-xl mr-2">
          <lucide-icon [img]="Building" class="h-6 w-6 text-white"></lucide-icon>
        </div>
        <!-- Texto con gradiente visible -->
        <span class="bg-gradient-to-r from-[#11a92f] to-[#067f2d] bg-clip-text text-transparent">Portal de
          Empleados</span>
      </a>

      <!-- Botón menú móvil -->
      <button class="lg:hidden focus:outline-none hover:bg-gray-100 p-2 rounded-lg text-gray-700" type="button"
        (click)="isMenuOpen = !isMenuOpen" aria-label="Toggle navigation">
        <lucide-icon [img]="isMenuOpen ? X : Menu" class="h-6 w-6"></lucide-icon>
      </button>

      <!-- Menú Desktop -->
      <div class="hidden lg:block">
        <div class="relative">
          <!-- Botón usuario con referencia #userMenuButton -->
          <a #userMenuButton class="flex items-center cursor-pointer" (click)="toggleUserMenu($event)">
            <div
              class="w-10 h-10 bg-gradient-to-r from-[#11a92f] to-[#067f2d] rounded-full flex items-center justify-center text-white font-semibold mr-3 avatar-pulse">
              {{ userInitial }}
            </div>
            <div class="text-left">
              <p class="text-sm font-medium text-gray-800">{{ employee?.userName || 'Usuario' }}</p>
              <p class="text-xs text-gray-500">{{ employee?.employeeEmail || 'correo@empresa.com' }}</p>
            </div>
            <lucide-icon [img]="ChevronDown" class="ml-2 h-4 w-4 text-gray-700"></lucide-icon>
          </a>

          <!-- Dropdown usuario con referencia #userMenuContent -->
          <div #userMenuContent *ngIf="isUserMenuOpen"
            class="absolute right-0 mt-2 w-56 bg-white backdrop-blur-md border border-gray-200 rounded-xl shadow-lg overflow-hidden z-50">
            <a class="flex items-center px-4 py-3 text-gray-700 hover:bg-gray-100 cursor-pointer" href="#">
              <lucide-icon [img]="User" class="mr-2 h-4 w-4"></lucide-icon> Mi Perfil
            </a>
            <a class="flex items-center px-4 py-3 text-gray-700 hover:bg-gray-100 cursor-pointer" href="#">
              <lucide-icon [img]="Settings" class="mr-2 h-4 w-4"></lucide-icon> Configuración
            </a>
            <div class="border-t border-gray-200"></div>
            <a class="flex items-center px-4 py-3 text-red-500 hover:bg-red-50 cursor-pointer" (click)="logout()">
              <lucide-icon [img]="LogOut" class="mr-2 h-4 w-4"></lucide-icon> Cerrar Sesión
            </a>
          </div>
        </div>
      </div>
    </div>

    <!-- Menú móvil -->
    <div *ngIf="isMenuOpen" class="lg:hidden py-4 border-t border-gray-200">
      <div class="flex items-center space-x-3 mb-4">
        <div
          class="w-10 h-10 bg-gradient-to-r from-[#11a92f] to-[#067f2d] rounded-full flex items-center justify-center text-white font-semibold">
          {{ userInitial }}
        </div>
        <div>
          <p class="text-sm font-medium text-gray-800">{{ employee?.userName || 'Usuario' }}</p>
          <p class="text-xs text-gray-500">{{ employee?.employeeEmail || 'correo@empresa.com' }}</p>
        </div>
      </div>
      <div class="space-y-2">
        <button
          class="flex items-center space-x-2 w-full text-left px-2 py-2 text-gray-700 hover:bg-gray-100 rounded-lg">
          <lucide-icon [img]="User" class="h-4 w-4"></lucide-icon>
          <span>Mi Perfil</span>
        </button>
        <button
          class="flex items-center space-x-2 w-full text-left px-2 py-2 text-gray-700 hover:bg-gray-100 rounded-lg">
          <lucide-icon [img]="Settings" class="h-4 w-4"></lucide-icon>
          <span>Configuración</span>
        </button>
        <button class="flex items-center space-x-2 w-full text-left px-2 py-2 hover:bg-red-50 rounded-lg text-red-500"
          (click)="logout()">
          <lucide-icon [img]="LogOut" class="h-4 w-4"></lucide-icon>
          <span>Cerrar Sesión</span>
        </button>
      </div>
    </div>
  </nav>


  <!-- CONTENIDO -->
  <div class="container mx-auto px-4">
    <!-- Encabezado -->
    <div class="mb-8 fade-in">
      <div class="dashboard-card border-white/20 hover:shadow-lg transition p-8 rounded-2xl">
        <div class="grid md:grid-cols-2 gap-8 items-center">

          <!-- Texto de bienvenida -->
          <div>
            <h2 class="text-4xl font-bold mb-3 text-gray-800">
              Bienvenido de nuevo,
              <span class="bg-gradient-to-r from-[#11a92f] to-[#067f2d] bg-clip-text text-transparent">
                {{ getUserFirstName() }}
              </span>
            </h2>
            <p class="text-gray-500 text-lg">
              Gestiona tus solicitudes e información de manera eficiente.
            </p>
          </div>

          <!-- Stats -->
          <div class="grid grid-cols-2 gap-6">
            <div class="dashboard-card bg-white/50 backdrop-blur-md p-6 rounded-2xl hover:shadow-md transition">
              <div class="flex items-center space-x-4">
                <div class="bg-[#11a92f]/10 p-3 rounded-xl">
                  <lucide-icon [img]="FileText" class="h-6 w-6 text-[#11a92f]"></lucide-icon>
                </div>
                <div>
                  <p class="text-3xl font-bold">{{ totalPqrs }}</p>
                  <p class="text-sm text-gray-500">Solicitudes</p>
                </div>
              </div>
            </div>

            <div class="dashboard-card bg-white/50 backdrop-blur-md p-6 rounded-2xl hover:shadow-md transition">
              <div class="flex items-center space-x-4">
                <div class="bg-[#28a745]/10 p-3 rounded-xl">
                  <lucide-icon [img]="CheckCircle" class="h-6 w-6 text-[#28a745]"></lucide-icon>
                </div>
                <div>
                  <p class="text-3xl font-bold">{{ resolvedPqrs }}</p>
                  <p class="text-sm text-gray-500">Resueltas</p>
                </div>
              </div>
            </div>
          </div>

        </div>
      </div>
    </div>

    <!-- Grid -->
    <div class="grid grid-cols-1 lg:grid-cols-12 gap-6">
      <!-- Perfil -->
      <div class="lg:col-span-4 fade-in" style="animation-delay: 100ms">
        <div class="dashboard-card h-full p-6 rounded-2xl shadow-md hover:shadow-lg transition">
          <!-- Header -->
          <div class="flex items-center justify-between mb-6">
            <h3 class="text-2xl font-bold text-gray-800">Mi Perfil</h3>
            <span
              class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-green-100 text-green-800">
              <span class="status-dot w-2 h-2 rounded-full bg-green-500 mr-2"></span>
              Activo
            </span>
          </div>

          <!-- Info -->
          <div class="space-y-6">
            <!-- Nombre -->
            <div class="flex items-start">
              <div class="bg-[#11a92f]/10 p-3 rounded-xl">
                <lucide-icon [img]="User" class="h-5 w-5 text-[#11a92f]"></lucide-icon>
              </div>
              <div class="ml-4">
                <p class="text-sm text-gray-500">Nombre</p>
                <p class="font-semibold text-gray-800">{{ employee?.userName || 'No disponible' }}</p>
              </div>
            </div>

            <!-- Email -->
            <div class="flex items-start border-t border-gray-100 pt-5">
              <div class="bg-blue-100 p-3 rounded-xl">
                <lucide-icon [img]="Mail" class="h-5 w-5 text-blue-600"></lucide-icon>
              </div>
              <div class="ml-4">
                <p class="text-sm text-gray-500">Email</p>
                <p class="font-semibold text-gray-800">{{ employee?.employeeEmail || 'No disponible' }}</p>
              </div>
            </div>

            <!-- Rol -->
            <div class="flex items-start border-t border-gray-100 pt-5">
              <div class="bg-yellow-100 p-3 rounded-xl">
                <lucide-icon [img]="Briefcase" class="h-5 w-5 text-yellow-600"></lucide-icon>
              </div>
              <div class="ml-4">
                <p class="text-sm text-gray-500">Rol</p>
                <p class="font-semibold text-gray-800">{{ employee?.employeeRole || 'No disponible' }}</p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Sistema PQRS -->
      <div class="lg:col-span-8 fade-in" style="animation-delay: 200ms">
        <div
          class="dashboard-card h-full p-6 rounded-2xl shadow-md hover:shadow-xl transition glass-strong border border-white/20">
          <!-- Header -->
          <div class="flex justify-between items-start mb-6">
            <div class="flex items-center space-x-4">
              <div class="bg-gradient-primary p-4 rounded-xl shadow-md">
                <lucide-icon [img]="Kanban" class="h-6 w-6 text-white"></lucide-icon>
              </div>
              <div>
                <h3 class="text-xl font-semibold">Sistema PQRS</h3>
                <p class="text-gray-500 text-sm">Gestión de solicitudes</p>
              </div>
            </div>

            <!-- Dropdown -->
            <div class="relative" (click)="$event.stopPropagation()">
              <button class="p-2 rounded-full hover:bg-gray-100 transition" (click)="toggleDropdown()">
                <lucide-icon [img]="MoreHorizontal" class="h-5 w-5"></lucide-icon>
              </button>

              <div *ngIf="isDropdownOpen"
                class="absolute right-0 mt-2 w-40 bg-white/80 backdrop-blur-md rounded-lg shadow-lg overflow-hidden z-40 border border-white/20">
                <a class="block px-4 py-2 text-gray-700 hover:bg-gray-100 transition-all duration-200 cursor-pointer"
                  href="#">
                  Ver todas
                </a>
                <a class="block px-4 py-2 text-gray-700 hover:bg-gray-100 transition-all duration-200 cursor-pointer"
                  href="#">
                  Exportar datos
                </a>
              </div>
            </div>
          </div>

          <!-- Content -->
          <p class="text-gray-600 mb-6">
            Gestión de Peticiones, Quejas, Reclamos y Sugerencias. Monitorea el estado
            de las solicitudes de manera eficiente.
          </p>

          <!-- Progress -->
          <div class="bg-gray-50/50 backdrop-blur-sm p-5 rounded-xl mb-6">
            <div class="flex justify-between items-center mb-2">
              <span class="text-gray-600">Solicitudes Completadas</span>
              <span class="font-semibold text-green-600">{{ resolvedPercentage }}%</span>
            </div>
            <div class="h-3 bg-gray-200 rounded-full overflow-hidden">
              <div class="h-full bg-gradient-to-r from-green-500 to-green-400 rounded-full"
                [style.width.%]="resolvedPercentage"></div>
            </div>
            <div class="flex justify-between text-sm text-gray-500 mt-2">
              <span>{{ resolvedPqrs }} resueltas</span>
              <span>{{ totalPqrs }} total</span>
            </div>
          </div>

          <!-- Buttons -->
          <div class="flex flex-col sm:flex-row gap-3 pt-2">
            <button class="btn-dashboard-primary flex-1" (click)="openPendingPqrsModal()">
              <lucide-icon [img]="Plus" class="h-4 w-4 mr-2"></lucide-icon>Ver
              Solicitudes Pendientes
            </button>
            <button class="btn-dashboard-outline flex-1">
              <lucide-icon [img]="List" class="h-4 w-4 mr-2"></lucide-icon>Ver
              Historial
            </button>
          </div>
        </div>
      </div>

      <!-- Accesos Rápidos -->
      <div class="lg:col-span-12 fade-in" style="animation-delay: 300ms">
        <div class="dashboard-card p-6">
          <h3 class="text-xl font-bold mb-6 flex items-center">
            <lucide-icon [img]="Zap" class="h-5 w-5 text-yellow-500 mr-2"></lucide-icon>
            Accesos Rápidos
          </h3>
          <div class="grid grid-cols-2 md:grid-cols-4 gap-6">
            <!-- Registrar Empleado (solo admin) -->
            <div *ngIf="isAdmin">
              <div class="dashboard-card p-5 text-center cursor-pointer" (click)="openRegistrationModal()">
                <div
                  class="mx-auto w-16 h-16 flex items-center justify-center rounded-xl bg-gradient-primary text-white mb-4 shadow-md">
                  <lucide-icon [img]="UserPlus" class="h-8 w-8"></lucide-icon>
                </div>
                <h4 class="font-semibold text-base mb-1">Registrar Empleado</h4>
                <p class="text-sm text-gray-500">Añadir nuevo</p>
              </div>
            </div>

            <div>
              <div class="dashboard-card p-5 text-center cursor-pointer" (click)="openRecipesModal()">
                <div
                  class="mx-auto w-16 h-16 flex items-center justify-center rounded-xl bg-gradient-warning text-white mb-4 shadow-md">
                  <lucide-icon [img]="BookOpen" class="h-8 w-8"></lucide-icon>
                </div>
                <h4 class="font-semibold text-base mb-1">Agregar Recetas</h4>
                <p class="text-sm text-gray-500">Nuevas preparaciones</p>
              </div>
            </div>

            <div>
              <div class="dashboard-card p-5 text-center cursor-pointer">
                <div
                  class="mx-auto w-16 h-16 flex items-center justify-center rounded-xl bg-gradient-danger text-white mb-4 shadow-md">
                  <lucide-icon [img]="Pencil" class="h-8 w-8"></lucide-icon>
                </div>
                <h4 class="font-semibold text-base mb-1">Editar perfil</h4>
                <p class="text-sm text-gray-500">Actualizar información</p>
              </div>
            </div>

            <div>
              <div class="dashboard-card p-5 text-center cursor-pointer">
                <div
                  class="mx-auto w-16 h-16 flex items-center justify-center rounded-xl bg-gradient-success text-white mb-4 shadow-md">
                  <lucide-icon [img]="Settings" class="h-8 w-8"></lucide-icon>
                </div>
                <h4 class="font-semibold text-base mb-1">Configuración</h4>
                <p class="text-sm text-gray-500">Preferencias</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Modales -->
    <app-employee-registration-modal (employeeAdded)="handleEmployeeAdded($event)"></app-employee-registration-modal>
    <app-recipe-registration-modal (recipeAdded)="handleRecipeAdded($event)"></app-recipe-registration-modal>
    <app-pending-pqrs-modal (pqrResolved)="handlePqrResolved($event)"
      (modalClosed)="handleModalClosed()"></app-pending-pqrs-modal>
  </div>
</div>